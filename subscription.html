<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NyamaTrack — Subscription | Nyamatrack.co.ke</title>
  <meta name="description" content="Subscribe your butchery to NyamaTrack. Flexible pricing, M‑Pesa and card options. Nyamatrack.co.ke" />
  <style>
    :root{
      color-scheme: dark;
      /* Neutral dark theme (not blue) */
      --bg:#0a0a0a;
      --bg-2:#0c0c0c;
      --card:#141414;
      --muted:#a1a1aa;
      --border:#262626;
      --primary:#e11d48; /* nyama red */
      --accent:#f59e0b;  /* amber */
      --good:#22c55e;
      --bad:#f43f5e;
      --ring:0 0 0 3px color-mix(in oklab, var(--primary), transparent 70%);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:white;
      background: var(--bg);
      -webkit-font-smoothing:antialiased;
      line-height:1.5;
    }
    a{color:inherit;text-decoration:none}
    .container{max-width:1100px;margin:0 auto;padding:24px}
    header{
      position:sticky; top:0; z-index:40;
      background: color-mix(in oklab, var(--bg-2), transparent 20%);
      backdrop-filter: blur(8px);
      border-bottom:1px solid var(--border);
    }
    nav{display:flex;align-items:center;justify-content:space-between;gap:16px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700;letter-spacing:0.3px}
    .brand-badge{
      width:28px;height:28px;border-radius:8px;
      background: radial-gradient(120px 80px at 70% 20%, var(--primary), transparent),
                  radial-gradient(120px 80px at 20% 80%, var(--accent), transparent),
                  linear-gradient(120deg, #1f1f1f, #0a0a0a);
      border:1px solid var(--border);
      box-shadow: 0 0 24px color-mix(in oklab, var(--primary), transparent 70%);
    }
    .nav-links{display:flex;gap:14px;flex-wrap:wrap}
    .nav-links a{color:var(--muted)}
    .nav-links a[aria-current="page"]{color:white}
    .btn{
      display:inline-flex;align-items:center;justify-content:center;gap:8px;
      padding:10px 14px;border-radius:10px;border:1px solid var(--border);
      background:linear-gradient(180deg, #1b1b1b, #121212);
      color:white; cursor:pointer; transition:transform .05s ease, background .2s;
    }
    .btn:hover{transform:translateY(-1px)}
    .btn.primary{background:linear-gradient(180deg, color-mix(in oklab, var(--primary) 80%, #0a0a0a), #8a0f2d); border-color:#5a0a20}
    .btn.ghost{background:transparent}
    .btn.block{width:100%}
    /* Background artistry (neutral dark) */
    .bg{
      position:fixed; inset:0; z-index:-1; overflow:hidden;
      background:
        radial-gradient(1200px 700px at -10% -20%, #1a0a0a 30%, transparent 60%),
        radial-gradient(900px 700px at 110% 110%, #14100a 25%, transparent 60%),
        linear-gradient(180deg, #0a0a0a, #0b0b0b);
    }
    .orb{
      position:absolute; width:600px; height:600px; border-radius:50%;
      filter: blur(70px); opacity:.25; mix-blend:screen; pointer-events:none;
      animation: float 16s ease-in-out infinite;
    }
    .orb.red{background: radial-gradient(circle at 30% 30%, var(--primary), transparent 60%)}
    .orb.amber{background: radial-gradient(circle at 60% 60%, var(--accent), transparent 60%); animation-duration: 20s}
    @keyframes float{
      0%,100%{transform: translate(0,0) scale(1)}
      50%{transform: translate(40px,-30px) scale(1.05)}
    }
    .grid-overlay{
      position:absolute; inset:0; background:
        linear-gradient(to right, rgba(255,255,255,.04) 1px, transparent 1px) 0 0/40px 40px,
        linear-gradient(to bottom, rgba(255,255,255,.04) 1px, transparent 1px) 0 0/40px 40px;
      mask-image: radial-gradient(1200px 800px at 50% 0%, black, transparent);
    }
    /* Layout */
    main{padding:40px 0}
    .hero{display:grid;gap:16px; text-align:center; padding:24px 0 8px}
    .hero h1{font-size:clamp(26px,3.6vw,40px); margin:0}
    .muted{color:var(--muted)}
    .content{display:grid; grid-template-columns:1.2fr .8fr; gap:24px; margin-top:24px}
    @media (max-width: 980px){ .content{grid-template-columns:1fr} }
    .card{
      background: linear-gradient(180deg, #161616, #121212);
      border:1px solid var(--border); border-radius:16px; padding:18px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.03)
    }
    .card + .card{margin-top:16px}
    .card h3{margin:0 0 8px 0; font-size:18px}
    .row{display:flex; gap:12px; flex-wrap:wrap}
    .field{display:grid; gap:8px; width:100%}
    label{font-size:14px;color:var(--muted)}
    input, select{
      width:100%; padding:12px 12px; border-radius:10px; border:1px solid var(--border);
      background:#0a0a0a; color:white; outline:none;
    }
    input:focus, select:focus{box-shadow: var(--ring)}
    /* Plans */
    .plans{display:grid; grid-template-columns: repeat(3, 1fr); gap:16px}
    @media (max-width:900px){ .plans{grid-template-columns: 1fr} }
    .plan{
      border:1px solid var(--border); border-radius:16px; padding:18px;
      background:linear-gradient(180deg, #151515, #111111);
      position:relative; display:grid; gap:8px
    }
    .plan input[type="radio"]{position:absolute; inset:0; opacity:0; cursor:pointer}
    .plan:hover{outline:1px solid color-mix(in oklab, var(--primary), transparent 60%)}
    .plan .price{font-size:28px; font-weight:700}
    .badge{display:inline-flex; align-items:center; gap:6px; font-size:12px; color:#111; background:linear-gradient(180deg, #fcd34d, #f59e0b); padding:4px 8px; border-radius:999px}
    .pill{display:inline-flex; align-items:center; gap:6px; font-size:12px; color:white; border:1px solid var(--border); padding:4px 8px; border-radius:999px; background:#0a0a0a}
    .switch{display:inline-flex; background:#0a0a0a; border:1px solid var(--border); border-radius:999px; padding:4px; gap:4px}
    .switch button{border:none; background:transparent; color:var(--muted); padding:8px 12px; border-radius:999px; cursor:pointer}
    .switch button.active{background:linear-gradient(180deg, color-mix(in oklab, var(--primary) 70%, #0a0a0a), #8a0f2d); color:white}
    .summary{display:grid; gap:8px}
    .summary .kpis{display:grid; grid-template-columns:repeat(3,1fr); gap:12px}
    @media (max-width:700px){ .summary .kpis{grid-template-columns:1fr} }
    .kpi{background:linear-gradient(180deg, #131313, #0f0f0f); border:1px solid var(--border); border-radius:12px; padding:12px}
    .kpi .value{font-size:20px; font-weight:700}
    /* Dialog */
    .dialog{position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.6)}
    .dialog .panel{max-width:420px; width:96%; background:#121212; border:1px solid var(--border); border-radius:16px; padding:18px}
    .spinner{width:18px; height:18px; border:3px solid rgba(255,255,255,.15); border-top-color:white; border-radius:50%; animation: spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    footer{color:var(--muted); font-size:13px; padding:24px 0 48px; text-align:center}
  </style>
</head>
<body>
  <div class="bg" aria-hidden="true">
    <div class="orb red" style="left:-120px; top:-120px"></div>
    <div class="orb amber" style="right:-120px; bottom:-120px"></div>
    <div class="grid-overlay"></div>
  </div>
  <header>
    <div class="container">
      <nav aria-label="Primary">
        <div class="brand">
          <div class="brand-badge" aria-hidden="true"></div>
          <a href="subscription.html" aria-label="NyamaTrack home">NyamaTrack</a>
          <span class="pill">Nyamatrack.co.ke</span>
        </div>
        <div class="nav-links">
          <a href="subscription.html" aria-current="page">Subscription</a>
          <a href="daily-reports.html">Daily Reports</a>
          <a href="algorithm-reports.html">Algorithm Reports</a>
        </div>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <h1>Subscribe Your Butchery</h1>
      <p class="muted">Secure billing with M‑Pesa and Cards. Choose a plan that scales with your meat business.</p>
    </section>

    <section class="content" aria-labelledby="plans">
      <div class="card">
        <div class="row" style="justify-content:space-between; align-items:center">
          <h3 id="plans">Plans</h3>
          <div class="switch" role="tablist" aria-label="Billing cadence">
            <button id="bill-monthly" class="active" role="tab" aria-selected="true">Monthly</button>
            <button id="bill-annual" role="tab" aria-selected="false">Annual <span class="badge" style="margin-left:6px">Save 17%</span></button>
          </div>
        </div>
        <div class="plans" id="plan-list"></div>
      </div>

      <aside class="card" aria-labelledby="checkout">
        <h3 id="checkout">Checkout</h3>
        <div class="field">
          <label for="butchery-name">Butchery Name</label>
          <input id="butchery-name" placeholder="e.g., Kayole Prime Meats" autocomplete="organization" />
        </div>
        <div class="field">
          <label for="email">Billing Email</label>
          <input id="email" type="email" placeholder="you@butchery.co.ke" autocomplete="email" />
        </div>
        <div class="field">
          <label for="payment-method">Payment Method</label>
          <select id="payment-method" aria-describedby="pm-note">
            <option value="mpesa">M‑Pesa STK Push</option>
            <option value="card">Debit/Credit Card</option>
            <option value="invoice">Invoice (Bank Transfer)</option>
          </select>
          <small id="pm-note" class="muted">We never store card or M‑Pesa PINs.</small>
        </div>

        <div id="mpesa-fields" class="row" style="margin-top:8px">
          <div class="field">
            <label for="mpesa-phone">M‑Pesa Phone (SafariCom)</label>
            <input id="mpesa-phone" inputmode="numeric" placeholder="07XXXXXXXX" />
          </div>
        </div>
        <div id="card-fields" class="row" style="display:none; margin-top:8px">
          <div class="field"><label>Card Number</label><input placeholder="4242 4242 4242 4242" inputmode="numeric" /></div>
          <div class="field"><label>Expiry</label><input placeholder="MM/YY" inputmode="numeric" /></div>
          <div class="field"><label>CVC</label><input placeholder="CVC" inputmode="numeric" /></div>
        </div>

        <div class="card" style="margin-top:14px">
          <div class="summary">
            <div class="row" style="justify-content:space-between; align-items:center">
              <strong>Order Summary</strong>
              <span class="pill" id="selected-plan-pill">No plan selected</span>
            </div>
            <div class="kpis">
              <div class="kpi">
                <div class="muted">Subtotal</div>
                <div class="value" id="subtotal">KES 0</div>
              </div>
              <div class="kpi">
                <div class="muted">Discount</div>
                <div class="value" id="discount">KES 0</div>
              </div>
              <div class="kpi">
                <div class="muted">Total</div>
                <div class="value" id="total">KES 0</div>
              </div>
            </div>
          </div>
        </div>

        <button class="btn primary block" id="pay-btn" aria-live="polite" disabled>Select a plan to continue</button>
        <p class="muted" style="margin-top:8px; font-size:12px">By subscribing you agree to NyamaTrack Terms and Privacy. Prices include VAT where applicable.</p>
      </aside>
    </section>

    <section class="card" style="margin-top:24px">
      <h3>Why NyamaTrack?</h3>
      <ul>
        <li>Daily and algorithmic reports to keep your butchery profitable.</li>
        <li>Kenyan-first billing with M‑Pesa support.</li>
        <li>Unlimited outlets per business on Business plan and above.</li>
      </ul>
    </section>
  </main>

  <div class="dialog" id="payment-dialog" role="dialog" aria-modal="true" aria-labelledby="pmt-title" aria-describedby="pmt-desc">
    <div class="panel">
      <div class="row" style="justify-content:space-between; align-items:center">
        <strong id="pmt-title">Processing Payment</strong>
        <button class="btn ghost" id="close-dialog" aria-label="Close dialog">Close</button>
      </div>
      <p class="muted" id="pmt-desc">If paying via M‑Pesa, approve the STK push on your phone.</p>
      <div class="row" style="align-items:center"><div class="spinner" aria-hidden="true"></div> <span id="pmt-status">Awaiting confirmation…</span></div>
    </div>
  </div>

  <footer>
    © <span id="year"></span> NyamaTrack — Nyamatrack.co.ke
  </footer>

  <script>
    const state = {
      cadence: 'monthly',
      plan: null,
      plans: {
        monthly: [
          {id:'starter', name:'Starter', price: 900, features:['Single outlet','Basic reports','Email support']},
          {id:'business', name:'Business', price: 2200, popular:true, features:['Up to 5 outlets','Advanced reports','Priority support']},
          {id:'pro', name:'Pro', price: 4200, features:['Unlimited outlets','API access','SLA support']},
        ],
        annual: [
          {id:'starter', name:'Starter', price: Math.round(900*12*0.83)},
          {id:'business', name:'Business', price: Math.round(2200*12*0.83), popular:true},
          {id:'pro', name:'Pro', price: Math.round(4200*12*0.83)},
        ]
      }
    };

    const planList = document.getElementById('plan-list');
    const billMonthly = document.getElementById('bill-monthly');
    const billAnnual  = document.getElementById('bill-annual');
    const payBtn = document.getElementById('pay-btn');
    const subtotalEl = document.getElementById('subtotal');
       const discountEl = document.getElementById('discount');
    const totalEl = document.getElementById('total');
    const pill = document.getElementById('selected-plan-pill');
    const cadenceButtons = [billMonthly, billAnnual];

    function formatKES(n){ return 'KES ' + n.toLocaleString('en-KE'); }

    function renderPlans(){
      planList.innerHTML = '';
      state.plans[state.cadence].forEach(p => {
        const price = p.price;
        const features = p.features || (p.id==='starter' ? ['Single outlet','Basic reports','Email support'] : p.id==='business' ? ['Up to 5 outlets','Advanced reports','Priority support'] : ['Unlimited outlets','API access','SLA support']);
        const el = document.createElement('div');
        el.className = 'plan';
        el.innerHTML = `
          <input type="radio" name="plan" aria-label="${p.name} plan" value="${p.id}">
          <div class="row" style="justify-content:space-between; align-items:center">
            <strong>${p.name}</strong>
            ${p.popular ? '<span class="badge" aria-label="Popular plan">Popular</span>' : ''}
          </div>
          <div class="price">${formatKES(price)} <span class="muted" style="font-size:13px">/${state.cadence==='monthly'?'mo':'yr'}</span></div>
          <ul style="margin:8px 0 0 18px; color:var(--muted); font-size:14px">
            ${features.map(f=><li>${f}</li>).join('')}
          </ul>
        `;
        el.querySelector('input').addEventListener('change', ()=>{
          state.plan = { ...p, price };
          updateSummary();
          payBtn.disabled = false;
          payBtn.textContent = 'Proceed to Pay';
        });
        planList.appendChild(el);
      });
      updateSummary();
    }

    function updateSummary(){
      const cadenceLabel = state.cadence==='monthly' ? 'Monthly' : 'Annual';
      if(!state.plan){
        subtotalEl.textContent = 'KES 0';
        discountEl.textContent = 'KES 0';
        totalEl.textContent = 'KES 0';
        pill.textContent = 'No plan selected';
        return;
      }
      const raw = state.plan.price;
      const discount = 0;
      const total = Math.max(0, raw - discount);
      subtotalEl.textContent = formatKES(raw);
      discountEl.textContent = formatKES(discount);
      totalEl.textContent = formatKES(total);
      pill.textContent = state.plan.name + ' · ' + cadenceLabel;
    }

    cadenceButtons.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        cadenceButtons.forEach(b=>{ b.classList.remove('active'); b.setAttribute('aria-selected','false'); });
        btn.classList.add('active'); btn.setAttribute('aria-selected','true');
        state.cadence = (btn===billMonthly)?'monthly':'annual';
        state.plan = null;
        payBtn.disabled = true;
        payBtn.textContent = 'Select a plan to continue';
        renderPlans();
      });
    });

    // Payment method toggle
    const pm = document.getElementById('payment-method');
    const mpesaFields = document.getElementById('mpesa-fields');
    const cardFields  = document.getElementById('card-fields');
    pm.addEventListener('change', ()=>{
      const v = pm.value;
      mpesaFields.style.display = (v==='mpesa')?'flex':'none';
      cardFields.style.display  = (v==='card')?'flex':'none';
    });

    // Mock payment flow (wire to backend later)
    const dialog = document.getElementById('payment-dialog');
    const closeDialog = document.getElementById('close-dialog');
    const statusEl = document.getElementById('pmt-status');
    const butcheryName = document.getElementById('butchery-name');
    const email = document.getElementById('email');
    const mpesaPhone = document.getElementById('mpesa-phone');

    payBtn.addEventListener('click', ()=>{
      if(!state.plan){ return; }
      if(!butcheryName.value.trim() || !email.value.trim()){
        alert('Please fill in Butchery Name and Billing Email');
        return;
      }
      if(pm.value==='mpesa' && !/^0\d{9}$/.test(mpesaPhone.value.trim())){
        alert('Please enter a valid M-Pesa phone (e.g., 07XXXXXXXX)');
        return;
      }
      dialog.style.display = 'grid';
      statusEl.textContent = pm.value==='mpesa' ? 'Awaiting M‑Pesa approval on your phone…' : 'Processing payment…';
      setTimeout(()=>{
        statusEl.textContent = 'Payment confirmed. Activating subscription…';
        const subscription = {
          butchery: butcheryName.value.trim(),
          email: email.value.trim(),
          method: pm.value,
          plan: state.plan.name,
          cadence: state.cadence,
          amount: state.plan.price,
          ts: new Date().toISOString()
        };
        localStorage.setItem('nyamatrack.subscription', JSON.stringify(subscription));
      }, 1200);
      setTimeout(()=>{
        dialog.style.display = 'none';
        alert('Subscription active! Thank you for choosing NyamaTrack.');
      }, 2200);
    });
    closeDialog.addEventListener('click', ()=> dialog.style.display='none');
    document.getElementById('year').textContent = new Date().getFullYear();

    renderPlans();
  </script>
</body>
</html>