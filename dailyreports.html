<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NyamaTrack — Daily Reports | Nyamatrack.co.ke</title>
  <meta name="description" content="Daily sales, expenses, profit and inventory reports for your butchery. Export CSV, print, and visualize trends. Nyamatrack.co.ke" />
  <style>
    :root{
      color-scheme: dark;
      --bg:#0a0a0a; --bg-2:#0c0c0c; --card:#141414; --muted:#a1a1aa; --border:#262626;
      --primary:#e11d48; --accent:#f59e0b; --good:#22c55e; --bad:#f43f5e;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica Neue,Arial;color:white;background:var(--bg);-webkit-font-smoothing:antialiased}
    a{color:inherit;text-decoration:none}
    .container{max-width:1200px;margin:0 auto;padding:24px}
    header{position:sticky;top:0;background:color-mix(in oklab, var(--bg-2), transparent 20%);backdrop-filter:blur(8px);border-bottom:1px solid var(--border);z-index:40}
    nav{display:flex;align-items:center;justify-content:space-between}
    .brand{display:flex;gap:10px;align-items:center;font-weight:700}
    .brand-badge{width:28px;height:28px;border-radius:8px;background:radial-gradient(120px 80px at 70% 20%, var(--primary), transparent),radial-gradient(120px 80px at 20% 80%, var(--accent), transparent),linear-gradient(120deg,#1f1f1f,#0a0a0a);border:1px solid var(--border);box-shadow:0 0 24px color-mix(in oklab, var(--primary), transparent 70%)}
    .nav-links{display:flex;gap:14px;flex-wrap:wrap}
    .nav-links a{color:var(--muted)}
    .nav-links a[aria-current="page"]{color:white}
    .bg{position:fixed;inset:0;z-index:-1;background:radial-gradient(1200px 700px at -10% -20%, #1a0a0a 25%, transparent 60%),radial-gradient(900px 700px at 110% 110%, #14100a 25%, transparent 60%),linear-gradient(180deg,#0a0a0a,#0b0b0b)}
    .orb{position:absolute;width:600px;height:600px;border-radius:50%;filter:blur(70px);opacity:.25;mix-blend:screen}
    .orb.red{left:-120px;top:-120px;background:radial-gradient(circle at 30% 30%, var(--primary), transparent 60%);animation:float 16s ease-in-out infinite}
    .orb.amber{right:-120px;bottom:-120px;background:radial-gradient(circle at 60% 60%, var(--accent), transparent 60%);animation:float 20s ease-in-out infinite}
    .grid-overlay{position:absolute;inset:0;background:linear-gradient(to right, rgba(255,255,255,.04) 1px, transparent 1px) 0 0/40px 40px,linear-gradient(to bottom, rgba(255,255,255,.04) 1px, transparent 1px) 0 0/40px 40px;mask-image:radial-gradient(1200px 800px at 50% 0%, black, transparent)}
    @keyframes float{0%,100%{transform:translate(0,0)}50%{transform:translate(40px,-30px)}}
    main{padding:34px 0}
    .hero{text-align:center}
    .hero h1{margin:0;font-size:clamp(26px,3.6vw,40px)}
    .muted{color:var(--muted)}
    .controls{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin:22px 0}
    @media (max-width:900px){.controls{grid-template-columns:1fr 1fr}}
    @media (max-width:600px){.controls{grid-template-columns:1fr}}
    label{font-size:13px;color:var(--muted)}
    input,select{width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:#0a0a0a;color:white}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px 14px;border-radius:10px;border:1px solid var(--border);background:linear-gradient(180deg,#1b1b1b,#121212);color:white;cursor:pointer}
    .btn.primary{background:linear-gradient(180deg, color-mix(in oklab, var(--primary) 80%, #0a0a0a), #8a0f2d); border-color:#5a0a20}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    @media (max-width:1000px){.grid{grid-template-columns:1fr 1fr}}
    @media (max-width:600px){.grid{grid-template-columns:1fr}}
    .card{background:linear-gradient(180deg,#161616,#121212);border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:inset 0 1px 0 rgba(255,255,255,.03)}
    .kpi{display:grid;gap:6px}
    .kpi .value{font-weight:700;font-size:22px}
    .kpi.good .value{color:var(--good)}
    .kpi.bad .value{color:var(--bad)}
    canvas{width:100%;height:260px;background:#0a0a0a;border-radius:12px;border:1px solid var(--border)}
    table{width:100%;border-collapse:separate;border-spacing:0;margin-top:8px}
    thead th{font-size:13px;color:var(--muted);text-align:left;border-bottom:1px solid var(--border);padding:10px}
    tbody td{padding:10px;border-bottom:1px dashed var(--border)}
    tbody tr:hover{background:#151515}
    .table-wrap{overflow:auto}
    .pill{display:inline-flex;align-items:center;gap:6px;font-size:12px;color:white;border:1px solid var(--border);padding:4px 8px;border-radius:999px;background:#0a0a0a}
    footer{color:var(--muted);font-size:13px;padding:24px 0 48px;text-align:center}
  </style>
</head>
<body>
  <div class="bg" aria-hidden="true">
    <div class="orb red"></div>
    <div class="orb amber"></div>
    <div class="grid-overlay"></div>
  </div>
  <header>
    <div class="container">
      <nav aria-label="Primary">
        <div class="brand">
          <div class="brand-badge" aria-hidden="true"></div>
          <a href="subscription.html" aria-label="NyamaTrack home">NyamaTrack</a>
          <span class="pill">Nyamatrack.co.ke</span>
        </div>
        <div class="nav-links">
          <a href="subscription.html">Subscription</a>
          <a href="daily-reports.html" aria-current="page">Daily Reports</a>
          <a href="algorithm-reports.html">Algorithm Reports</a>
        </div>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <h1>Daily Reports</h1>
      <p class="muted">Track today’s sales, expenses, profit and inventory across outlets. Export and print in one click.</p>
    </section>

    <section class="controls" aria-label="Filters">
      <div>
        <label for="date">Date</label>
        <input id="date" type="date" />
      </div>
      <div>
        <label for="outlet">Outlet</label>
        <select id="outlet">
          <option value="all">All Outlets</option>
          <option>Nairobi CBD</option>
          <option>Westlands</option>
          <option>Kayole</option>
        </select>
      </div>
      <div>
        <label for="category">Category</label>
        <select id="category">
          <option value="all">All</option>
          <option value="beef">Beef</option>
          <option value="goat">Goat</option>
          <option value="chicken">Chicken</option>
          <option value="other">Other</option>
        </select>
      </div>
      <div class="row" style="align-items:flex-end">
        <button class="btn primary" id="apply">Apply</button>
        <button class="btn" id="export">Export CSV</button>
        <button class="btn" id="print">Print</button>
      </div>
    </section>

    <section class="grid" aria-label="Key metrics">
      <div class="card kpi">
        <div class="muted">Total Sales</div>
        <div class="value" id="k-sales">KES 0</div>
        <small class="muted" id="k-sales-ch">0% vs yesterday</small>
      </div>
      <div class="card kpi">
        <div class="muted">Expenses</div>
        <div class="value" id="k-expenses">KES 0</div>
        <small class="muted" id="k-expenses-ch">0% vs yesterday</small>
      </div>
      <div class="card kpi">
        <div class="muted">Profit</div>
        <div class="value" id="k-profit">KES 0</div>
        <small class="muted" id="k-profit-ch">0% vs yesterday</small>
      </div>
      <div class="card kpi">
        <div class="muted">Inventory (kg)</div>
        <div class="value" id="k-inventory">0 kg</div>
        <small class="muted">End of day estimate</small>
      </div>
    </section>

    <section class="card" style="margin-top:16px">
      <div class="row" style="justify-content:space-between;align-items:center">
        <strong>Sales vs Expenses</strong>
        <span class="muted" id="chart-range"></span>
      </div>
      <canvas id="barChart" role="img" aria-label="Bar chart showing sales vs expenses"></canvas>
    </section>

    <section class="card" style="margin-top:16px">
      <div class="row" style="justify-content:space-between;align-items:center">
        <strong>Transactions</strong>
        <span class="muted" id="tx-count">0 transactions</span>
      </div>
      <div class="table-wrap">
        <table aria-describedby="tx-count">
          <thead>
            <tr>
              <th>Date/Time</th>
              <th>Outlet</th>
              <th>Category</th>
              <th>Type</th>
              <th>Qty (kg)</th>
              <th>Amount (KES)</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </section>
  </main>

  <footer>
    © <span id="year"></span> NyamaTrack — Nyamatrack.co.ke
  </footer>

  <script>
    // Minimal chart utilities
    function drawBars(canvas, labels, a, b, colors={a:'#22c55e', b:'#f59e0b'}) {
      const dpr = window.devicePixelRatio || 1;
      const ctx = canvas.getContext('2d');
      const W = canvas.clientWidth * dpr;
      const H = canvas.clientHeight * dpr;
      canvas.width = W; canvas.height = H;
      ctx.scale(dpr, dpr);
      const w = canvas.clientWidth, h = canvas.clientHeight;
      const pad = {l:40, r:10, t:10, b:30};
      const max = Math.max(1, ...a, ...b) * 1.15;
      // axes
      ctx.clearRect(0,0,w,h);
      ctx.strokeStyle='rgba(255,255,255,.15)';
      ctx.lineWidth = 1;
      ctx.beginPath(); ctx.moveTo(pad.l, pad.t); ctx.lineTo(pad.l, h - pad.b); ctx.lineTo(w - pad.r, h - pad.b); ctx.stroke();
      // grid + labels
      ctx.font = '12px system-ui';
      ctx.fillStyle = 'rgba(255,255,255,.6)';
      const steps=4;
      for(let i=1;i<=steps;i++){
        const y = pad.t + (h-pad.t-pad.b)*(1 - i/steps);
        ctx.strokeStyle='rgba(255,255,255,.08)'; ctx.beginPath(); ctx.moveTo(pad.l, y); ctx.lineTo(w-pad.r, y); ctx.stroke();
        const val = Math.round(max*i/steps);
        ctx.fillText(val.toLocaleString('en-KE'), 6, y+4);
      }
      // bars
      const N = labels.length;
      const groupW = (w - pad.l - pad.r) / N;
      const barW = Math.max(6, (groupW-10)/2);
      for(let i=0;i<N;i++){
        const x = pad.l + i*groupW + 5;
        const y0 = h - pad.b;
        const hA = (a[i]/max)*(h-pad.t-pad.b);
        ctx.fillStyle = colors.a; ctx.globalAlpha=.9;
        ctx.fillRect(x, y0-hA, barW, hA);
        const hB = (b[i]/max)*(h-pad.t-pad.b);
        ctx.fillStyle = colors.b;
        ctx.fillRect(x+barW+4, y0-hB, barW, hB);
        // x label
        ctx.globalAlpha=.85; ctx.fillStyle='rgba(255,255,255,.75)';
        ctx.save(); ctx.translate(x, y0+16); ctx.rotate(-0.26);
        ctx.fillText(labels[i], 0, 0); ctx.restore();
      }
      ctx.globalAlpha=1;
      // legend
      ctx.fillStyle='#ffffff';
      ctx.fillRect(w/dpr-160, 10, 10, 10); ctx.fillText('Sales', w/dpr-145, 19);
      ctx.fillStyle=colors.b; ctx.fillRect(w/dpr-100, 10, 10, 10); ctx.fillText('Expenses', w/dpr-85, 19);
    }

    // Demo/seed data generator for a day
    const rng = (seed=17)=>()=> (seed = (seed*16807)%2147483647) / 2147483647;
    const rand = rng(2541);

    function seedTransactions(dateStr){
      const outlets = ['Nairobi CBD','Westlands','Kayole'];
      const cats = ['beef','goat','chicken','other'];
      const tx = [];
      for(let h=7; h<=21; h++){
        const entries = Math.floor(rand()*4)+1;
        for(let i=0;i<entries;i++){
          const outlet = outlets[Math.floor(rand()*outlets.length)];
          const cat = cats[Math.floor(rand()*cats.length)];
          const type = rand() > .2 ? 'Sale' : 'Expense';
          const qty = type==='Sale' ? +(rand()*12 + 1).toFixed(1) : 0;
          const amount = type==='Sale' ? Math.round(qty * (cat==='beef'? 800 : cat==='goat'? 750 : cat==='chicken'? 650 : 500)) : Math.round(rand()*800 + 200);
          const dt = new Date(dateStr); dt.setHours(h, Math.floor(rand()*60), 0, 0);
          tx.push({datetime: dt.toISOString(), outlet, category:cat, type, qty, amount});
        }
      }
      return tx;
    }

    function filterTx(tx, outlet, category){
      return tx.filter(t => (outlet==='all' || t.outlet===outlet) && (category==='all' || t.category===category));
    }

    function computeKPIs(tx){
      const sales = tx.filter(t=>t.type==='Sale').reduce((s,t)=>s+t.amount,0);
      const expenses = tx.filter(t=>t.type!=='Sale').reduce((s,t)=>s+t.amount,0);
      const profit = sales - expenses;
      const qtySold = tx.filter(t=>t.type==='Sale').reduce((s,t)=>s+t.qty,0);
      const invStartKg = 1200; // demo baseline
      const inventory = Math.max(0, invStartKg - qtySold);
      return {sales, expenses, profit, inventory};
    }

    function populateTable(tbody, tx){
      tbody.innerHTML = tx.map(t=>{
        const d = new Date(t.datetime);
        return `<tr>
          <td>${d.toLocaleString()}</td>
          <td>${t.outlet}</td>
          <td>${t.category}</td>
          <td>${t.type}</td>
          <td>${t.qty ? t.qty.toFixed(1): '-'}</td>
          <td>${t.amount.toLocaleString('en-KE')}</td>
        </tr>`;
      }).join('');
    }

    function percentChange(today, yesterday){
      if(yesterday===0) return 100;
      return ((today - yesterday)/yesterday)*100;
    }

    function exportCSV(filename, tx){
      const header = ['Date/Time','Outlet','Category','Type','Qty (kg)','Amount (KES)'];
      const rows = tx.map(t=>[
        new Date(t.datetime).toLocaleString(),
        t.outlet, t.category, t.type, t.qty || '', t.amount
      ]);
      const csv = [header, ...rows].map(r=>r.map(v => '"' + String(v).replace(/"/g,'""') + '"').join(',')).join('\n');
      const blob = new Blob([csv],{type:'text/csv'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = filename;
      a.click(); URL.revokeObjectURL(a.href);
    }

    // DOM refs
    const dateEl = document.getElementById('date');
    const outletEl = document.getElementById('outlet');
    const categoryEl = document.getElementById('category');
    const applyBtn = document.getElementById('apply');
    const exportBtn = document.getElementById('export');
    const printBtn = document.getElementById('print');
    const kSales = document.getElementById('k-sales');
    const kExpenses = document.getElementById('k-expenses');
    const kProfit = document.getElementById('k-profit');
    const kInv = document.getElementById('k-inventory');
    const kSalesCh = document.getElementById('k-sales-ch');
    const kExpensesCh = document.getElementById('k-expenses-ch');
    const kProfitCh = document.getElementById('k-profit-ch');
    const tbody = document.getElementById('tbody');
    const chart = document.getElementById('barChart');
    const chartRange = document.getElementById('chart-range');
    const txCount = document.getElementById('tx-count');

    // Initialize
    const today = new Date(); const isoToday = today.toISOString().slice(0,10);
    dateEl.value = isoToday;
    let TX_CACHE = {};
    function getDayTx(iso){
      if(!TX_CACHE[iso]) TX_CACHE[iso] = seedTransactions(iso);
      return TX_CACHE[iso];
    }
    function apply(){
      const iso = dateEl.value || isoToday;
      const prev = new Date(iso); prev.setDate(prev.getDate()-1); const prevIso = prev.toISOString().slice(0,10);
      const tx = filterTx(getDayTx(iso), outletEl.value, categoryEl.value);
      const txY = filterTx(getDayTx(prevIso), outletEl.value, categoryEl.value);
      const k = computeKPIs(tx), kY = computeKPIs(txY);
      kSales.textContent = 'KES ' + k.sales.toLocaleString('en-KE'); kSalesCh.textContent = percentChange(k.sales, kY.sales).toFixed(1)+'% vs yesterday';
      kExpenses.textContent = 'KES ' + k.expenses.toLocaleString('en-KE'); kExpensesCh.textContent = percentChange(k.expenses, kY.expenses).toFixed(1)+'% vs yesterday';
      kProfit.textContent = 'KES ' + k.profit.toLocaleString('en-KE'); kProfitCh.textContent = percentChange(k.profit, kY.profit).toFixed(1)+'% vs yesterday';
      kInv.textContent = k.inventory.toFixed(0) + ' kg';
      populateTable(tbody, tx);
      txCount.textContent = tx.length + ' transactions';
      // Hourly bars
      const labels = []; const sales = []; const expenses = [];
      for(let h=7; h<=21; h++){
        labels.push(h+':00');
        const hourTx = tx.filter(t=>new Date(t.datetime).getHours()===h);
        sales.push(hourTx.filter(t=>t.type==='Sale').reduce((s,t)=>s+t.amount,0));
        expenses.push(hourTx.filter(t=>t.type!=='Sale').reduce((s,t)=>s+t.amount,0));
      }
      drawBars(chart, labels, sales, expenses);
      const rangeLabel = new Date(iso).toLocaleDateString(undefined, {weekday:'short', year:'numeric', month:'short', day:'numeric'});
      chartRange.textContent = rangeLabel;
    }

    applyBtn.addEventListener('click', apply);
    exportBtn.addEventListener('click', ()=>{
      const iso = dateEl.value || isoToday;
      const tx = filterTx(getDayTx(iso), outletEl.value, categoryEl.value);
      exportCSV(`nyamatrack_daily_${iso}.csv`, tx);
    });
    printBtn.addEventListener('click', ()=> window.print());
    document.getElementById('year').textContent = new Date().getFullYear();

    // Auto-apply on load
    apply();
  </script>
</body>
</html>